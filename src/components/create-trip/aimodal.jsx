import { GoogleGenerativeAI } from "@google/generative-ai";

const apiKey = import.meta.env.VITE_GOOGLE_GEMINI_AI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-2.5-pro-preview-03-25",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 64,
  maxOutputTokens: 65536,
  responseModalities: [
  ],
  responseMimeType: "application/json",
};

// async function run() {
  export const chatSession = model.startChat({
    generationConfig,
    history: [
      {
        role: "user",
        parts: [
          {text: "Generate a travel plan for location: dubai for 3 days for couple with a cheap budget. give me a hotel options with hotel name, hotel address, price, hotel image url, geo coordinates, rating, descriptions and suggest itinerary with placeName, place details, place image URL, geo coordinates, ticket pricing, time taken in each of locations for 3 days with each day plan with best time to visit in JSON format "},
        ],
      },
      {
        role: "model",
        parts: [
          {text: "Here's a breakdown of the thought process to generate the Dubai travel plan:\n\n1.  **Understand the Core Request:** The user wants a 3-day travel plan for a couple visiting Dubai on a *cheap budget*. Key elements needed:\n    *   Location: Dubai\n    *   Duration: 3 days\n    *   Target Audience: Couple\n    *   Budget: Cheap/Budget-friendly\n    *   Output Format: JSON\n    *   Specific JSON Structure:\n        *   Hotel Options (multiple): Name, Address, Price (approximate/budget range), Image URL, Geo Coordinates (Lat/Lon), Rating, Description.\n        *   Itinerary (3 days):\n            *   Day Plan (for each day):\n                *   Best Time to Visit (overall for the day/season).\n                *   Places: placeName, place details, place image URL, geo coordinates, ticket pricing (approximate/budget-friendly focus), time taken at location.\n\n2.  **Deconstruct the Request & Identify Constraints:**\n    *   **Cheap Budget:** This is the primary constraint. It influences hotel choices, activity selection, transportation methods (implied - suggest Metro), and food options (implied - suggest cheaper eats, maybe food courts or local cafeterias). Ticket prices should reflect free or low-cost options where possible.\n    *   **Couple:** While not drastically changing the itinerary compared to a solo traveler, it suggests including some potentially romantic spots (like a fountain show, maybe a walk by the creek) but still keeping it budget-friendly.\n    *   **3 Days:** Need to structure the itinerary logically across three distinct days, balancing activities and travel time. Avoid packing too much in.\n    *   **JSON Format:** Strict requirement for the final output. Need to design the JSON structure correctly based on the user's specifications.\n    *   **Specific Data Points:** Need to find or estimate: Hotel names, addresses, *approximate* prices (crucial for budget), image URLs, geo-coordinates, ratings, descriptions, place names, place details, place image URLs, geo-coordinates, *approximate* ticket prices, and estimated time spent.\n\n3.  **Information Gathering & Strategy (Simulated):**\n\n    *   **Budget Hotels in Dubai:**\n        *   *Keywords:* \"budget hotels dubai\", \"cheap hotels dubai\", \"affordable accommodation dubai deira\", \"hostels dubai\" (though maybe not ideal for a couple, worth considering for price point), \"hotels near dubai metro cheap\".\n        *   *Areas:* Deira and Bur Dubai are traditionally more budget-friendly than Downtown, Marina, or JBR. Proximity to a Metro station is key for cheap transport.\n        *   *Selection Criteria:* Aim for hotels with decent ratings (3.5+), known budget chains (like Rove, Ibis Styles, maybe some independent ones), and relatively easy Metro access. *Need to find placeholder images, addresses, coordinates, and estimate prices (e.g., $50-$100/night range).* Get descriptions focusing on value and location.\n        *   *Example Search Results (Mental Simulation):* Rove Downtown (might be slightly above *cheapest* but good value), Ibis Styles Dragon Mart (a bit out but cheap), hotels in Al Barsha near Mall of the Emirates Metro, hotels in Deira near Union or Al Rigga Metro. Let's pick a few representative options across different budget areas. *Selected: Rove City Centre (Deira - good balance), Ibis Al Rigga (Deira - classic budget), Gateway Hotel (Bur Dubai - traditional area).*\n\n    *   **Budget-Friendly Activities in Dubai:**\n        *   *Keywords:* \"free things to do dubai\", \"cheap activities dubai\", \"dubai attractions low cost\", \"dubai creek abra\", \"dubai old souk\", \"dubai mall fountain show\", \"kite beach dubai\".\n        *   *Focus Areas:* Old Dubai (Creek, Souks, Al Fahidi), Free attractions (Fountain Show, walk around Marina/JBR, Kite Beach), potentially one paid but iconic view (Burj Khalifa *at the top* is expensive, but viewing *from the ground* is free; maybe Frame is a cheaper alternative?). Malls are free to enter.\n        *   *Transport:* Emphasize Dubai Metro and Abra crossing. Taxis are expensive.\n        *   *Food:* Mention food courts in malls, local cafeterias (\"karak and regag\"), supermarkets.\n\n    *   **Itinerary Structuring (3 Days):**\n        *   **Day 1: Old Dubai Focus:** Makes sense geographically. Start with Al Fahidi Historical Neighbourhood, Dubai Museum (cheap), Abra ride across the Creek, explore Gold and Spice Souks. This is very budget-friendly.\n        *   **Day 2: Modern Dubai Contrast (Budget Edition):** Focus on Downtown. Dubai Mall (free entry, window shopping), see the Burj Khalifa from outside (free), watch the Dubai Fountain show (free). Maybe add Kite Beach (free) for a relaxed afternoon/sunset if time/transport allows, or Dubai Marina walk (free).\n        *   **Day 3: Mix & Optional Paid Activity:** Maybe Mall of the Emirates (see Ski Dubai from outside - free), Souk Madinat Jumeirah (nice atmosphere, free to walk around), potentially a beach again or maybe a slightly more affordable paid attraction if the budget stretches (e.g., Dubai Frame offers good views for less than Burj Khalifa At The Top). Or keep it very cheap with more exploration of a different area or revisiting a favorite spot. Let's go with Dubai Marina Walk & JBR for a different modern vibe, ending perhaps near Mall of the Emirates for easy metro access back.\n\n    *   **Data Point Collection (Simulated/Placeholder):**\n        *   *Geo Coordinates:* Use Google Maps to find Lat/Lon for each hotel and attraction.\n        *   *Image URLs:* Search for representative, license-appropriate images (e.g., Wikimedia Commons, Unsplash, Pixabay, or just generic placeholders if specific licensing is tricky). For a real application, APIs would be used. *Using placeholder URLs for now.*\n        *   *Prices:* Research approximate current prices for budget hotels ($50-100), Metro rides (NOL card cost + per trip), Abra ride (1 AED), Dubai Museum (3 AED), Dubai Frame (~50 AED). Mark others as \"Free\". State prices are *approximate*.\n        *   *Time Taken:* Estimate reasonable duration for each activity (e.g., Souks 1-2 hrs, Museum 1 hr, Fountain show 30 mins, Travel time between major areas 30-60 mins via Metro).\n        *   *Best Time to Visit:* Generally Nov-Mar for pleasant weather. For specific activities: Fountains - evening; Souks - morning/evening (avoid midday heat); Beaches - morning/late afternoon.\n\n4.  **JSON Structure Implementation:**\n    *   Create the main JSON object `{}`.\n    *   Add the `travelPlan` key with an object value.\n    *   Inside `travelPlan`, add keys: `location`, `duration`, `targetAudience`, `budget`.\n    *   Add the `hotelOptions` key with an array `[]` value. Populate this array with hotel objects, each having the required keys (name, address, price, imageURL, geoCoordinates, rating, description). Ensure `geoCoordinates` is an object with `lat` and `lon`.\n    *   Add the `itinerary` key with an array `[]` value, one object per day.\n    *   Each day object should have `day` (number), `bestTimeToVisit` (string), and `plan` (array of activities).\n    *   Each activity object within the `plan` array needs `placeName`, `details`, `imageURL`, `geoCoordinates` (object with lat/lon), `ticketPricing` (string, indicate if free or approx. cost), and `timeTaken` (string).\n\n5.  **Refinement and Review:**\n    *   **Budget Check:** Does the itinerary rely heavily on expensive activities or transport? No, focuses on Metro, Abra, free sights, and cheap paid sights. Hotel options are in the budget range.\n    *   **Flow:** Does the daily plan make geographical sense? Yes, Day 1 is Old Dubai, Day 2 is Downtown, Day 3 is Marina/JBR/MOE area. Minimizes excessive back-and-forth.\n    *   **Couple Suitability:** Includes Fountain Show, Marina walk, Souk Madinat - nice ambiances.\n    *   **Completeness:** Are all requested JSON fields present? Yes.\n    *   **Clarity:** Are descriptions helpful? Are price estimates realistic (and noted as approximate)? Is the time allocation reasonable? Yes. Added notes about using the Metro and getting a NOL card.\n    *   **JSON Validity:** Double-check syntax (commas, brackets, quotes).\n\n6.  **Final Output Generation:** Assemble the collected information into the final JSON structure."},
          {text: "```json\n{\n  \"travelPlan\": {\n    \"location\": \"Dubai, UAE\",\n    \"duration\": \"3 Days\",\n    \"targetAudience\": \"Couple\",\n    \"budget\": \"Cheap / Budget-Friendly\",\n    \"notes\": \"This plan focuses on maximizing experiences while minimizing costs. It heavily utilizes the Dubai Metro (purchase a NOL card) and walking. Food costs can be kept low by eating at food courts in malls or local cafeterias in older parts of Dubai (Deira/Bur Dubai). Prices are estimates and subject to change.\",\n    \"hotelOptions\": [\n      {\n        \"name\": \"Rove City Centre, Deira\",\n        \"address\": \"24 19B Street, Deira, Dubai, UAE\",\n        \"price\": \"Approx. $60-90 USD per night\",\n        \"imageURL\": \"https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80\",\n        \"geoCoordinates\": {\n          \"lat\": 25.2597,\n          \"lon\": 55.3311\n        },\n        \"rating\": \"4.5/5 (Approx)\",\n        \"description\": \"Trendy budget-friendly hotel chain known for clean rooms, good amenities, and convenient locations. Close to Deira City Centre Metro Station, providing easy access to the rest of the city and the airport.\"\n      },\n      {\n        \"name\": \"Ibis Al Rigga\",\n        \"address\": \"Al Rigga Road, Deira, Dubai, UAE\",\n        \"price\": \"Approx. $50-80 USD per night\",\n        \"imageURL\": \"https://images.unsplash.com/photo-1582719508461-905c673771fd?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1074&q=80\",\n        \"geoCoordinates\": {\n          \"lat\": 25.2645,\n          \"lon\": 55.3218\n        },\n        \"rating\": \"3.5/5 (Approx)\",\n        \"description\": \"A reliable international budget hotel option in the bustling Deira area. Close to Al Rigga Metro Station, numerous restaurants, and shops. Offers basic but comfortable accommodation.\"\n      },\n      {\n        \"name\": \"Gateway Hotel\",\n        \"address\": \"Khaleed Bin Waleed Road, Bur Dubai, Dubai, UAE\",\n        \"price\": \"Approx. $55-85 USD per night\",\n        \"imageURL\": \"https://images.unsplash.com/photo-1542314831-068cd1dbb5eb?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80\",\n        \"geoCoordinates\": {\n          \"lat\": 25.2610,\n          \"lon\": 55.2955\n        },\n        \"rating\": \"4.0/5 (Approx)\",\n        \"description\": \"Located in Bur Dubai, offering good value for money. It's within walking distance to Al Fahidi Historical Neighbourhood and Sharaf DG or Al Ghubaiba Metro Stations. Provides comfortable rooms and often includes rooftop pool access.\"\n      }\n    ],\n    \"itinerary\": [\n      {\n        \"day\": 1,\n        \"theme\": \"Old Dubai Charm & Culture\",\n        \"bestTimeToVisit\": \"November - March (cooler weather). Visit souks morning or late afternoon.\",\n        \"plan\": [\n          {\n            \"placeName\": \"Al Fahidi Historical Neighbourhood (Old Dubai)\",\n            \"details\": \"Explore the traditional Emirati architecture, narrow alleyways, wind towers, art galleries, and cafes. It offers a glimpse into Dubai's past before the oil boom.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1582507126977-c076msa42e8d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.2637,\n              \"lon\": 55.2975\n            },\n            \"ticketPricing\": \"Free to walk around\",\n            \"timeTaken\": \"2-3 hours\"\n          },\n          {\n            \"placeName\": \"Dubai Museum (inside Al Fahidi Fort)\",\n            \"details\": \"Located within the Al Fahidi Fort (oldest existing building in Dubai), the museum showcases Dubai's history and transformation using dioramas and artifacts.\",\n            \"imageURL\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Dubai_Museum_courtyard.jpg/1024px-Dubai_Museum_courtyard.jpg\",\n            \"geoCoordinates\": {\n              \"lat\": 25.2647,\n              \"lon\": 55.2971\n            },\n            \"ticketPricing\": \"Approx. 3 AED per person (Very Cheap)\",\n            \"timeTaken\": \"1-1.5 hours\"\n          },\n          {\n            \"placeName\": \"Abra Ride across Dubai Creek\",\n            \"details\": \"Take a traditional wooden boat (Abra) across the Dubai Creek from Bur Dubai Abra Station to Deira Old Souk Abra Station. It's a quintessential Dubai experience and incredibly cheap.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1520454974749-611b72486448?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.2660,\n              \"lon\": 55.3010\n            },\n            \"ticketPricing\": \"1 AED per person per trip (pay cash on boat)\",\n            \"timeTaken\": \"15-20 minutes (including waiting)\"\n          },\n          {\n            \"placeName\": \"Gold Souk & Spice Souk\",\n            \"details\": \"Wander through the dazzling Gold Souk with its glittering window displays and then explore the aromatic Spice Souk nearby, filled with exotic spices, herbs, teas, and fragrances. Bargaining is expected if buying.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1580461540839-86eashf6ae0e?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1074&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.2721,\n              \"lon\": 55.2970\n            },\n            \"ticketPricing\": \"Free to browse\",\n            \"timeTaken\": \"1.5-2.5 hours (depending on interest)\"\n          }\n        ]\n      },\n      {\n        \"day\": 2,\n        \"theme\": \"Modern Marvels on a Budget\",\n        \"bestTimeToVisit\": \"November - March. Visit Dubai Mall during the day, Fountain show in the evening.\",\n        \"plan\": [\n          {\n            \"placeName\": \"Dubai Mall\",\n            \"details\": \"One of the world's largest shopping malls. Window shop, see the Dubai Aquarium's large outer tank for free, walk around, and grab a budget-friendly meal at the vast food court.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1566576721346-d4a3b4d3b3e3?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=987&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.1984,\n              \"lon\": 55.2797\n            },\n            \"ticketPricing\": \"Free entry (activities inside vary)\",\n            \"timeTaken\": \"3-4 hours (can be longer or shorter)\"\n          },\n          {\n            \"placeName\": \"Burj Khalifa (View from outside)\",\n            \"details\": \"Witness the world's tallest building from the Waterfront Promenade outside the Dubai Mall. Going 'At The Top' is expensive, but viewing from the ground is free and impressive.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1582672074140-5d0cb4a0f7b8?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=687&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.1972,\n              \"lon\": 55.2744\n            },\n            \"ticketPricing\": \"Free (to view from outside)\",\n            \"timeTaken\": \"30 minutes (for photos and viewing)\"\n          },\n          {\n            \"placeName\": \"Dubai Fountain Show\",\n            \"details\": \"Watch the spectacular water and light show choreographed to music on the Burj Khalifa Lake, right outside the Dubai Mall. Shows run frequently in the evenings.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1535080170794-51ae9a439303?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1074&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.1950,\n              \"lon\": 55.2750\n            },\n            \"ticketPricing\": \"Free\",\n            \"timeTaken\": \"30 minutes per show (recommend watching one or two)\"\n          }\n        ]\n      },\n      {\n        \"day\": 3,\n        \"theme\": \"Coastal Vibes & Souk Style\",\n        \"bestTimeToVisit\": \"November - March. Visit beach/Marina morning or late afternoon.\",\n        \"plan\": [\n          {\n            \"placeName\": \"Kite Beach\",\n            \"details\": \"A popular public beach known for watersports (watching is free!), a relaxed vibe, food trucks, and great views of the Burj Al Arab in the distance. Good for a morning walk or swim.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1590879481770-e38a3c5e2a8c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1470&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.1818,\n              \"lon\": 55.2256\n            },\n            \"ticketPricing\": \"Free\",\n            \"timeTaken\": \"2-3 hours\"\n          },\n          {\n            \"placeName\": \"Souk Madinat Jumeirah\",\n            \"details\": \"A modern take on a traditional souk, with winding alleyways, shops, restaurants, and waterways offering views of the Burj Al Arab. It's more upscale than the old souks but free to wander and enjoy the atmosphere.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1607819661938-9c7d84e4d3e3?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1074&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.1328,\n              \"lon\": 55.1861\n            },\n            \"ticketPricing\": \"Free to browse\",\n            \"timeTaken\": \"1.5-2 hours\"\n          },\n          {\n            \"placeName\": \"Dubai Marina Walk & JBR\",\n            \"details\": \"Stroll along the Dubai Marina Walk, admiring the stunning skyscrapers and yachts. Cross over to JBR (Jumeirah Beach Residence) 'The Walk' & 'The Beach' for a lively atmosphere, street art, public beach access, and budget-friendly food options.\",\n            \"imageURL\": \"https://images.unsplash.com/photo-1518684079-3c830dcef494?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=987&q=80\",\n            \"geoCoordinates\": {\n              \"lat\": 25.0770,\n              \"lon\": 55.1340\n            },\n            \"ticketPricing\": \"Free\",\n            \"timeTaken\": \"2-3 hours (evening is nice)\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```"},
        ],
      },
    ],
  });

  